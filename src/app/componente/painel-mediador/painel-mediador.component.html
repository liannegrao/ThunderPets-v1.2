<!-- Header -->
<div class="painel-header">
  <div class="container">
    <div class="header-content">
      <div class="header-text">
        <h1>ğŸ›ï¸ Painel do Mediador</h1>
        <p class="header-subtitle">Gerencie adoÃ§Ãµes, usuÃ¡rios e acompanhe as conexÃµes terapÃªuticas</p>
      </div>
      <div class="header-actions">
        <button class="btn-secondary" (click)="logout()">Sair</button>
      </div>
    </div>
  </div>
</div>

<main class="painel-main">
  <div class="container">

    <!-- Navigation Tabs -->
    <div class="nav-tabs">
      <button
        class="nav-tab"
        [class.active]="activeTab === 'dashboard'"
        (click)="setActiveTab('dashboard')"
      >
        ğŸ“Š Dashboard
      </button>
      <button
        class="nav-tab"
        [class.active]="activeTab === 'pets'"
        (click)="setActiveTab('pets')"
      >
        ğŸ¾ Gerenciar Pets
      </button>
      <button
        class="nav-tab"
        [class.active]="activeTab === 'usuarios'"
        (click)="setActiveTab('usuarios')"
      >
        ğŸ‘¥ UsuÃ¡rios
      </button>
      <button
        class="nav-tab"
        [class.active]="activeTab === 'depoimentos'"
        (click)="setActiveTab('depoimentos')"
      >
        ğŸ’¬ Depoimentos
      </button>
      <button
        class="nav-tab"
        [class.active]="activeTab === 'solicitacoes-adocao'"
        (click)="setActiveTab('solicitacoes-adocao')"
      >
        ğŸ“ SolicitaÃ§Ãµes
      </button>
      <button
        class="nav-tab"
        [class.active]="activeTab === 'relatorios'"
        (click)="setActiveTab('relatorios')"
      >
        ğŸ“ˆ RelatÃ³rios
      </button>
    </div>

    <!-- Dashboard Tab -->
    <div *ngIf="activeTab === 'dashboard'" class="tab-content">
      <!-- Statistics Cards -->
      <div class="stats-grid">
        <div *ngFor="let stat of estatisticas" class="stat-card">
          <div class="stat-icon">{{ stat.icone }}</div>
          <div class="stat-content">
            <h3 class="stat-value" [style.color]="stat.cor">{{ stat.valor }}</h3>
            <p class="stat-title">{{ stat.titulo }}</p>
          </div>
        </div>
      </div>

      <!-- Quick Overview Cards -->
      <div class="overview-grid">
        <div class="overview-card warning">
          <h3>ğŸ“‹ Pets Pendentes</h3>
          <p class="overview-number">{{ getPendingPetsCount() }}</p>
          <p class="overview-desc">Aguardando aprovaÃ§Ã£o</p>
        </div>
        <div class="overview-card success">
          <h3>ğŸ¾ Pets DisponÃ­veis</h3>
          <p class="overview-number">{{ getAvailablePetsCount() }}</p>
          <p class="overview-desc">Prontos para adoÃ§Ã£o</p>
        </div>
        <div class="overview-card info">
          <h3>â¤ï¸ Pets Adotados</h3>
          <p class="overview-number">{{ getAdoptedPetsCount() }}</p>
          <p class="overview-desc">ConexÃµes terapÃªuticas realizadas</p>
        </div>
      </div>

      <!-- Recent Activity -->
      <div class="activity-card">
        <h3>ğŸ“± Atividade Recente</h3>
        <div class="activity-list">
          <div class="activity-item">
            <span class="activity-icon">âœ…</span>
            <div class="activity-content">
              <p class="activity-title">Nova adoÃ§Ã£o terapÃªutica</p>
              <p class="activity-desc">JoÃ£o adotou Luna hÃ¡ 2 horas</p>
            </div>
          </div>
          <div class="activity-item">
            <span class="activity-icon">â¤ï¸</span>
            <div class="activity-content">
              <p class="activity-title">AvaliaÃ§Ã£o positiva</p>
              <p class="activity-desc">Maria deu 5 estrelas para Thor</p>
            </div>
          </div>
          <div class="activity-item">
            <span class="activity-icon">ğŸ”„</span>
            <div class="activity-content">
              <p class="activity-title">Pet aprovado</p>
              <p class="activity-desc">Cachorro Buddy agora estÃ¡ disponÃ­vel</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Pets Management Tab -->
    <div *ngIf="activeTab === 'pets'" class="tab-content">
      <!-- Pets Summary -->
      <div class="pets-summary">
        <div class="summary-item">
          <h3>ğŸ“‹ Pendentes ({{ getPendingPetsCount() }})</h3>
          <p>Aguardando sua aprovaÃ§Ã£o</p>
        </div>
        <div class="summary-item">
          <h3>ğŸ¾ DisponÃ­veis ({{ getAvailablePetsCount() }})</h3>
          <p>Prontos para adoÃ§Ã£o</p>
        </div>
        <div class="summary-item">
          <h3>â¤ï¸ Adotados ({{ getAdoptedPetsCount() }})</h3>
          <p>ConexÃµes realizadas</p>
        </div>
      </div>

      <!-- Pets Lists -->
      <div class="pets-section">
        <!-- Pending Pets -->
        <div *ngIf="getPendingPetsCount() > 0" class="pets-list">
          <h3>ğŸ”” Pets Aguardando AprovaÃ§Ã£o</h3>
        <div class="pets-grid">
          <div *ngFor="let pet of getPetsPorStatus('pendente')" class="pet-card-mediador">
            <div class="pet-header">
              <img [src]="pet.foto_url || '/img/THUNDERPETS (4) (1).png'" [alt]="pet.nome" class="pet-foto">
              <div class="pet-info">
                <h4>{{ pet.nome }}</h4>
                <p>{{ pet.raca }} â€¢ {{ pet.idade }} meses â€¢ {{ pet.porte }}</p>
                <p class="pet-doador" *ngIf="pet.doador">ğŸ‘¤ {{ pet.doador.nome }}</p>
              </div>
              <div class="pet-status" [style.background-color]="getStatusColor(pet.status)">
                {{ getStatusLabel(pet.status) }}
              </div>
            </div>
            <div class="pet-description">
              <p>{{ pet.personalidade }}</p>
            </div>
            <div class="pet-actions">
              <button class="btn-approve" (click)="aprovarPet(pet)">âœ… Aprovar</button>
              <button class="btn-reject" (click)="rejeitarPet(pet)">âŒ Rejeitar</button>
              <button *ngIf="currentUser?.role === 'mediador'" class="btn-edit" (click)="openEditPet(pet)" title="Editar (Mediador)">âœï¸ Editar</button>
            </div>
          </div>
        </div>
        </div>

        <!-- Available Pets -->
        <div class="pets-list">
          <h3>ğŸ¾ Pets DisponÃ­veis</h3>
          <div class="pets-grid">
            <div *ngFor="let pet of getPetsPorStatus('aprovado')" class="pet-card-mediador">
              <div class="pet-header">
                <img [src]="pet.foto_url || '/img/THUNDERPETS (4) (1).png'" [alt]="pet.nome" class="pet-foto">
                <div class="pet-info">
                  <h4>{{ pet.nome }}</h4>
                  <p>{{ pet.raca }} â€¢ {{ pet.idade }} meses â€¢ {{ pet.porte }}</p>
                  <p class="pet-doador" *ngIf="pet.doador">ğŸ‘¤ {{ pet.doador.nome }}</p>
                </div>
                <div class="pet-status" [style.background-color]="getStatusColor(pet.status)">
                  {{ getStatusLabel(pet.status) }}
                </div>
              </div>
              <div class="pet-description">
                <p>{{ pet.personalidade }}</p>
              </div>
              <div class="pet-actions">
                <button class="btn-adopt" (click)="marcarComoAdotado(pet)">â¤ï¸ Marcar como Adotado</button>
                <button *ngIf="currentUser?.role === 'mediador'" class="btn-edit" (click)="openEditPet(pet)" title="Editar (Mediador)">âœï¸ Editar</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Adopted Pets -->
        <div class="pets-list">
          <div class="section-header-with-actions">
            <h3>â¤ï¸ Pets Adotados</h3>
            <button *ngIf="getAdoptedPetsCount() > 0"
                    class="btn-cleanup"
                    (click)="limparPetsAdotados()"
                    title="Limpar/finalizar pets adotados">
              ğŸ§¹ Limpar Pets Adotados
            </button>
          </div>
          <div class="pets-grid">
            <div *ngFor="let pet of getPetsPorStatus('adotado')" class="pet-card-mediador">
              <div class="pet-header">
                <img [src]="pet.foto_url || '/img/THUNDERPETS (4) (1).png'" [alt]="pet.nome" class="pet-foto">
                <div class="pet-info">
                  <h4>{{ pet.nome }}</h4>
                  <p>{{ pet.raca }} â€¢ {{ pet.idade }} meses â€¢ {{ pet.porte }}</p>
                  <p class="pet-doador" *ngIf="pet.doador">ğŸ‘¤ {{ pet.doador.nome }}</p>
                </div>
                <div class="pet-status" [style.background-color]="getStatusColor(pet.status)">
                  {{ getStatusLabel(pet.status) }}
                </div>
              </div>
              <div class="pet-description">
                <p>{{ pet.personalidade }}</p>
              </div>
            </div>
          </div>
          <div *ngIf="getAdoptedPetsCount() === 0" class="empty-section">
            <div class="empty-icon">ğŸ‰</div>
            <p>Nenhum pet adotado ainda. As adoÃ§Ãµes aparecerÃ£o aqui quando forem realizadas.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Users Management Tab -->
    <div *ngIf="activeTab === 'usuarios'" class="tab-content">
      <!-- Users Summary -->
      <div class="users-summary">
        <div class="summary-item">
          <h3>ğŸ¯ Mediadores</h3>
          <p>{{ getUsuariosPorRole('mediador').length }} usuÃ¡rios</p>
        </div>
        <div class="summary-item">
          <h3>ğŸ¾ Doadores e Adotantes</h3>
          <p>{{ getUsuariosPorRole('doador').length + getUsuariosPorRole('comum').length }} usuÃ¡rios</p>
        </div>
      </div>

      <!-- Users Lists -->
      <div class="users-section">
        <!-- Mediadores -->
        <div class="users-list">
          <h3>ğŸ¯ Mediadores</h3>
          <div class="users-grid">
            <div *ngFor="let user of getUsuariosPorRole('mediador')" class="user-card">
              <div class="user-avatar">ğŸ¯</div>
              <div class="user-info">
                <h4>{{ user.nome }}</h4>
                <p>{{ user.email }}</p>
                <p class="user-role">{{ getRoleLabel(user.role) }}</p>
              </div>
              <button class="btn-delete-user" (click)="excluirUsuario(user.email)">ğŸ—‘ï¸</button>
            </div>
          </div>
        </div>



        <!-- Doadores -->
        <div class="users-list">
          <h3>ğŸ¾ Doadores e Adotantes</h3>
          <div class="users-grid">
            <div *ngFor="let user of getUsuariosPorRole('doador').concat(getUsuariosPorRole('adotante')).concat(getUsuariosPorRole('comum'))" class="user-card">
              <div class="user-avatar">ğŸ¾</div>
              <div class="user-info">
                <h4>{{ user.nome }}</h4>
                <p>{{ user.email }}</p>
                <p class="user-role">{{ getRoleLabel(user.role) }}</p>
              </div>
              <button class="btn-delete-user" (click)="excluirUsuario(user.email)">ğŸ—‘ï¸</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Depoimentos Tab -->
    <div *ngIf="activeTab === 'depoimentos'" class="tab-content">
      <div class="depoimentos-section">
        <!-- Depoimentos Pendentes -->
        <div class="depoimentos-list">
          <h3>ğŸ”” Depoimentos Pendentes de AprovaÃ§Ã£o ({{ getDepoimentosPendentes().length }})</h3>
          <div *ngIf="getDepoimentosPendentes().length > 0; else noPendentes" class="depoimentos-grid">
            <div *ngFor="let depoimento of getDepoimentosPendentes()" class="depoimento-card">
              <p class="depoimento-texto">"{{ depoimento.depoimento }}"</p>
              <p class="depoimento-autor">- {{ depoimento.nome }}</p>
              <div class="depoimento-actions">
                <button class="btn-approve" (click)="aprovarDepoimento(depoimento)">âœ… Aprovar</button>
                <button class="btn-reject" (click)="rejeitarDepoimento(depoimento)">âŒ Rejeitar</button>
                <button class="btn-edit" (click)="abrirModalEdicao(depoimento)">âœï¸ Editar</button>
              </div>
              <div *ngIf="depoimento.fotoUrl" class="depoimento-imagem">
                <img [src]="depoimento.fotoUrl" alt="Foto do depoimento">
              </div>
            </div>
          </div>
          <ng-template #noPendentes>
            <div class="empty-section">
              <p>Nenhum depoimento pendente no momento.</p>
            </div>
          </ng-template>
        </div>

        <!-- Depoimentos Aprovados -->
        <div class="depoimentos-list">
          <h3>âœ… Depoimentos Aprovados ({{ getDepoimentosAprovados().length }})</h3>
          <div *ngIf="getDepoimentosAprovados().length > 0; else noAprovados" class="depoimentos-grid">
            <div *ngFor="let depoimento of getDepoimentosAprovados()" class="depoimento-card approved">
              <p class="depoimento-texto">"{{ depoimento.depoimento }}"</p>
              <p class="depoimento-autor">- {{ depoimento.nome }}</p>
              <div class="depoimento-actions">
                <button class="btn-edit" (click)="abrirModalEdicao(depoimento)">âœï¸ Editar</button>
                <button class="btn-reject" (click)="rejeitarDepoimento(depoimento)">âŒ Reverter</button>
              </div>
              <div *ngIf="depoimento.fotoUrl" class="depoimento-imagem">
                <img [src]="depoimento.fotoUrl" alt="Foto do depoimento">
              </div>
            </div>
          </div>
          <ng-template #noAprovados>
            <div class="empty-section">
              <p>Nenhum depoimento aprovado ainda.</p>
            </div>
          </ng-template>
        </div>
      </div>
    </div>

    <!-- Reports Tab -->
    <div *ngIf="activeTab === 'relatorios'" class="tab-content">
      <div class="reports-card">
        <h3>ğŸ“Š RelatÃ³rios de AdoÃ§Ãµes</h3>
        <div class="report-stats">
          <div class="report-stat">
            <h4>Total de Pets</h4>
            <p class="stat-number">{{ pets.length }}</p>
          </div>
          <div class="report-stat">
            <h4>Taxa de AdoÃ§Ã£o</h4>
            <p class="stat-number">{{ estatisticas[3].valor }}</p>
          </div>
          <div class="report-stat">
            <h4>UsuÃ¡rios Ativos</h4>
            <p class="stat-number">{{ usuarios.length }}</p>
          </div>
        </div>
        <div class="report-message">
          <p>Funcionalidades avanÃ§adas de relatÃ³rios estarÃ£o disponÃ­veis em versÃµes futuras.</p>
        </div>
      </div>
    </div>

    <!-- SolicitaÃ§Ãµes de AdoÃ§Ã£o Tab -->
    <div *ngIf="activeTab === 'solicitacoes-adocao'" class="tab-content">
      <h2 class="section-title">ğŸ¾ SolicitaÃ§Ãµes de AdoÃ§Ã£o Pendentes</h2>
      <div class="depoimento-grid">
        <div *ngFor="let solicitacao of solicitacoesAdocao" class="solicitacao-card">
          <div class="pet-info">
            <img [src]="solicitacao.pet.foto_url || solicitacao.pet.foto || '/img/THUNDERPETS (4) (1).png'" alt="Foto de {{ solicitacao.pet.nome }}" class="pet-foto">
            <div>
              <h4>{{ solicitacao.pet.nome }}</h4>
              <p>{{ solicitacao.pet.raca }}</p>
            </div>
          </div>
          <div class="solicitante-info">
            <p><strong>Solicitante:</strong> {{ solicitacao.solicitante.nome }}</p>
            <p><strong>Email:</strong> {{ solicitacao.solicitante.email }}</p>
            <p><strong>Data:</strong> {{ solicitacao.data | date: 'dd/MM/yyyy' }}</p>
          </div>
          <div class="actions">
            <button (click)="aprovarSolicitacao(solicitacao)" class="btn-approve">Aprovar</button>
            <button (click)="rejeitarSolicitacao(solicitacao)" class="btn-reject">Rejeitar</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>

<!-- ===== MODAL DE EDIÃ‡ÃƒO DE DEPOIMENTO ===== -->
<div class="pet-modal-overlay" *ngIf="isEditingDepoimento" (click)="cancelarEdicaoDepoimento()">
  <div class="pet-modal editing" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Editar Depoimento</h2>
      <button class="modal-close" (click)="cancelarEdicaoDepoimento()">&times;</button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label>Depoimento</label>
        <textarea [(ngModel)]="editingDepoimentoData.depoimento" rows="6"></textarea>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-cancel" (click)="cancelarEdicaoDepoimento()">Cancelar</button>
      <button class="btn-save" (click)="salvarEdicaoDepoimento()">Salvar AlteraÃ§Ãµes</button>
    </div>
  </div>
</div>

<!-- ===== MODAL DE EDIÃ‡ÃƒO DE PET (Mediador) ===== -->
<div class="pet-modal-overlay" *ngIf="isEditing && editingPet" (click)="cancelEditPet()">
  <div class="pet-modal editing" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Editar: {{ editingPet.nome }}</h2>
      <button class="modal-close" (click)="cancelEditPet()">&times;</button>
    </div>
    <div class="modal-body">
      <div class="form-grid">
        <div class="form-group">
          <label>Nome</label>
          <input [(ngModel)]="editedData.nome" />
        </div>
        <div class="form-group">
          <label>RaÃ§a</label>
          <input [(ngModel)]="editedData.raca" />
        </div>
        <div class="form-group">
          <label>Idade (meses)</label>
          <input type="number" [(ngModel)]="editedData.idade" />
        </div>
        <div class="form-group">
          <label>Porte</label>
          <select [(ngModel)]="editedData.porte">
            <option value="pequeno">Pequeno</option>
            <option value="medio">MÃ©dio</option>
            <option value="grande">Grande</option>
          </select>
        </div>
        <div class="form-group">
          <label>NÃ­vel de Energia</label>
          <select [(ngModel)]="editedData.energia">
            <option value="calmo-caseiro">Calmo/Caseiro</option>
            <option value="moderado">Moderado/Ativo</option>
            <option value="alto">Hiperativo</option>
          </select>
        </div>
        <div class="form-group">
          <label>BenefÃ­cio Emocional</label>
          <input [(ngModel)]="editedData.beneficioEmocional" />
        </div>
        <div class="form-group">
          <label>Personalidade</label>
          <textarea [(ngModel)]="editedData.personalidade"></textarea>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-cancel" (click)="cancelEditPet()">Cancelar</button>
      <button class="btn-save" (click)="saveEditPet()">Salvar</button>
    </div>
  </div>
</div>
